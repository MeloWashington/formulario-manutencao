<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de OS - Age Telecom</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos anteriores mantidos */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #27ae60;
            --warning: #f39c12;
            --tech-bg: linear-gradient(135deg, #1e3a5f, #2c3e50);
            --super-bg: linear-gradient(135deg, #2c5a2c, #1e3a1e);
            --admin-bg: linear-gradient(135deg, #5a2c5a, #3c1e3c);
            --card-tech: rgba(30, 58, 95, 0.7);
            --card-super: rgba(44, 90, 44, 0.7);
            --card-admin: rgba(90, 44, 90, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--tech-bg);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.5s ease;
        }
        
        body.admin-mode {
            background: var(--admin-bg);
        }
        
        body.supervisor-mode {
            background: var(--super-bg);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .login-container, .app-container {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }
        
        .app-container {
            max-width: 100%;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo i {
            font-size: 64px;
            color: var(--secondary);
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .login-logo h1 {
            font-size: 2.2rem;
            color: var(--light);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light);
            display: flex;
            align-items: center;
        }
        
        label i {
            margin-right: 10px;
            color: var(--secondary);
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .btn {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            border: none;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn.loading {
            position: relative;
            color: transparent;
        }
        
        .btn.loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .user-details h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .user-role {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .role-tech {
            background: rgba(41, 128, 185, 0.3);
            border: 1px solid var(--secondary);
        }
        
        .role-super {
            background: rgba(39, 174, 96, 0.3);
            border: 1px solid var(--success);
        }
        
        .role-admin {
            background: rgba(155, 89, 182, 0.3);
            border: 1px solid #9b59b6;
        }
        
        .logout-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--accent);
            color: var(--light);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.3);
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--card-tech);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .admin-panel .card {
            background: var(--card-admin);
        }
        
        .supervisor-panel .card {
            background: var(--card-super);
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--success), var(--warning));
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .card i {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--light);
        }
        
        .card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .service-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 10px;
            margin-bottom: 30px;
        }
        
        .service-type {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 20px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .service-type:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: var(--secondary);
            transform: translateY(-3px);
        }
        
        .service-type.selected {
            background: rgba(39, 174, 96, 0.3);
            border-color: var(--success);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .service-type i {
            font-size: 28px;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .supervisor-panel, .admin-panel {
            display: none;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .panel-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .export-btn {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-weight: 600;
        }
        
        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .os-table-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        thead th {
            background: rgba(0, 0, 0, 0.4);
            font-weight: 600;
            color: var(--secondary);
            position: sticky;
            top: 0;
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .service-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-ativacao {
            background: rgba(41, 128, 185, 0.3);
            border: 1px solid var(--secondary);
        }
        
        .badge-visita {
            background: rgba(243, 156, 18, 0.3);
            border: 1px solid var(--warning);
        }
        
        .badge-mudanca {
            background: rgba(155, 89, 182, 0.3);
            border: 1px solid #9b59b6;
        }
        
        .badge-mesh {
            background: rgba(39, 174, 96, 0.3);
            border: 1px solid var(--success);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: var(--success);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--accent);
        }
        
        .no-data {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .no-data i {
            font-size: 48px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.3);
        }
        
        .user-id {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 3px;
        }
        
        .tech-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .tech-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }
        
        .tech-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tech-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .tech-info h4 {
            margin-bottom: 3px;
        }
        
        .tech-info p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .stats-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 200px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .stat-item h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .stat-item p {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .login-error {
            color: var(--accent);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }
        
        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .login-container, .app-container {
                padding: 20px;
            }
            
            .user-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .logout-btn {
                width: 100%;
                justify-content: center;
            }
            
            .panel-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .export-btn {
                width: 100%;
            }
            
            .stats-row {
                flex-direction: column;
            }
            
            .service-types {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body id="body">
    <div class="container">
        <!-- Tela de Login -->
        <div class="login-container" id="login-container">
            <div class="login-logo">
                <i class="fas fa-network-wired"></i>
                <h1>Age Telecom</h1>
                <p>Sistema de Gestão de OS</p>
            </div>
            
            <div class="login-tabs">
                <div class="tab active" data-tab="tech-tab">Técnico</div>
                <div class="tab" data-tab="admin-tab">Administração</div>
            </div>
            
            <!-- Aba Técnico -->
            <div class="tab-content active" id="tech-tab">
                <div class="form-group">
                    <label for="tech-select"><i class="fas fa-user"></i> Selecione seu nome</label>
                    <select id="tech-select">
                        <option value="">Carregando técnicos...</option>
                    </select>
                </div>
                
                <button class="btn" id="tech-login-btn">
                    <i class="fas fa-sign-in-alt"></i> Acessar como Técnico
                </button>
            </div>
            
            <!-- Aba Administração (Supervisor e Admin) -->
            <div class="tab-content" id="admin-tab">
                <div class="form-group">
                    <label for="login-email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="login-email" placeholder="Digite seu email" autocomplete="off">
                    <div class="login-error" id="email-error">Email não encontrado</div>
                </div>
                
                <div class="form-group">
                    <label for="login-password"><i class="fas fa-lock"></i> Senha</label>
                    <input type="password" id="login-password" placeholder="Digite sua senha" autocomplete="off">
                    <div class="login-error" id="password-error">Senha incorreta</div>
                </div>
                
                <button class="btn" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </div>
        </div>
        
        <!-- Painel do Técnico -->
        <div class="app-container" id="tech-container">
            <div class="user-header">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">T</div>
                    <div class="user-details">
                        <h2 id="user-name">Técnico</h2>
                        <span class="user-role role-tech" id="user-role">Técnico</span>
                        <div class="user-id" id="user-id">ID: 0000</div>
                    </div>
                </div>
                <div class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </div>
            </div>
            
            <div class="dashboard-cards">
                <div class="card">
                    <i class="fas fa-file-alt"></i>
                    <h3 id="os-count">0</h3>
                    <p>OS Encerradas</p>
                </div>
                
                <div class="card">
                    <i class="fas fa-bolt"></i>
                    <h3 id="ativacao-count">0</h3>
                    <p>Ativações</p>
                </div>
                
                <div class="card">
                    <i class="fas fa-tools"></i>
                    <h3 id="visita-count">0</h3>
                    <p>Visitas Técnicas</p>
                </div>
                
                <div class="card">
                    <i class="fas fa-exchange-alt"></i>
                    <h3 id="mudanca-count">0</h3>
                    <p>Mudanças</p>
                </div>
            </div>
            
            <div class="panel-header">
                <h2><i class="fas fa-plus-circle"></i> Cadastrar Nova OS</h2>
            </div>
            
            <form id="os-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cliente"><i class="fas fa-user"></i> Cliente</label>
                        <input type="text" id="cliente" name="cliente" placeholder="Nome completo do cliente" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contrato"><i class="fas fa-file-alt"></i> Contrato</label>
                        <input type="text" id="contrato" name="contrato" placeholder="Número do contrato" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tools"></i> Tipo de Serviço</label>
                    <div class="service-types">
                        <div class="service-type" data-value="ATIVAÇÃO">
                            <i class="fas fa-bolt"></i>
                            <h3>ATIVAÇÃO</h3>
                        </div>
                        
                        <div class="service-type" data-value="VISITA TÉCNICA">
                            <i class="fas fa-tools"></i>
                            <h3>VISITA</h3>
                        </div>
                        
                        <div class="service-type" data-value="MUDANÇA DE ENDEREÇO">
                            <i class="fas fa-truck-moving"></i>
                            <h3>MUDANÇA</h3>
                        </div>
                        
                        <div class="service-type" data-value="MESH">
                            <i class="fas fa-wifi"></i>
                            <h3>MESH</h3>
                        </div>
                    </div>
                    <input type="hidden" id="servico" name="servico" required>
                </div>
                
                <button type="submit" class="btn" id="submit-btn">
                    <i class="fas fa-paper-plane"></i> Cadastrar OS
                </button>
            </form>
        </div>
        
        <!-- Painel do Supervisor -->
        <div class="app-container supervisor-panel" id="supervisor-container">
            <div class="user-header">
                <div class="user-info">
                    <div class="user-avatar" id="super-avatar">S</div>
                    <div class="user-details">
                        <h2 id="super-name">Supervisor</h2>
                        <span class="user-role role-super" id="super-role">Supervisor</span>
                        <div class="user-id" id="super-id">ID: 0000</div>
                    </div>
                </div>
                <div class="logout-btn" id="super-logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </div>
            </div>
            
            <div class="stats-row">
                <div class="stat-item">
                    <h3 id="tech-count">0</h3>
                    <p>Técnicos na Equipe</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="team-os-count">0</h3>
                    <p>OS da Equipe</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="active-techs">0</h3>
                    <p>Técnicos Ativos</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="os-mes">0</h3>
                    <p>OS Este Mês</p>
                </div>
            </div>
            
            <div class="panel-header">
                <h2><i class="fas fa-users"></i> Técnicos da Equipe</h2>
            </div>
            
            <div class="tech-list" id="tech-list">
                <!-- Técnicos serão carregados aqui -->
            </div>
            
            <div class="panel-header">
                <h2><i class="fas fa-list"></i> Últimas OS da Equipe</h2>
                <div class="export-btn" id="super-export-btn">
                    <i class="fas fa-file-export"></i> Exportar Relatório
                </div>
            </div>
            
            <div class="os-table-container">
                <table id="super-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Contrato</th>
                            <th>Serviço</th>
                            <th>Técnico</th>
                        </tr>
                    </thead>
                    <tbody id="super-table-body">
                        <!-- Dados serão carregados aqui -->
                    </tbody>
                </table>
                <div id="super-no-data" class="no-data">
                    <i class="fas fa-inbox"></i>
                    <h3>Nenhuma ordem de serviço encontrada</h3>
                    <p>Não há OS cadastradas para sua equipe</p>
                </div>
            </div>
        </div>
        
        <!-- Painel do Administrador -->
        <div class="app-container admin-panel" id="admin-container">
            <div class="user-header">
                <div class="user-info">
                    <div class="user-avatar" id="admin-avatar">A</div>
                    <div class="user-details">
                        <h2 id="admin-name">Administrador</h2>
                        <span class="user-role role-admin" id="admin-role">Master</span>
                        <div class="user-id" id="admin-id">ID: ADMIN</div>
                    </div>
                </div>
                <div class="logout-btn" id="admin-logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </div>
            </div>
            
            <div class="stats-row">
                <div class="stat-item">
                    <h3 id="supervisor-count">0</h3>
                    <p>Supervisores</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="technician-count">0</h3>
                    <p>Técnicos</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="total-os-count">0</h3>
                    <p>Total de OS</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="os-today">0</h3>
                    <p>OS Hoje</p>
                </div>
                
                <div class="stat-item">
                    <h3 id="os-month">0</h3>
                    <p>OS Este Mês</p>
                </div>
            </div>
            
            <div class="panel-header">
                <h2><i class="fas fa-database"></i> Todas as Ordens de Serviço</h2>
                <div class="export-btn" id="admin-export-btn">
                    <i class="fas fa-file-export"></i> Exportar Relatório Completo
                </div>
            </div>
            
            <div class="os-table-container">
                <table id="admin-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Contrato</th>
                            <th>Serviço</th>
                            <th>Técnico</th>
                            <th>Supervisor</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body">
                        <!-- Dados serão carregados aqui -->
                    </tbody>
                </table>
                <div id="admin-no-data" class="no-data">
                    <i class="fas fa-inbox"></i>
                    <h3>Nenhuma ordem de serviço cadastrada</h3>
                    <p>O sistema ainda não possui OS cadastradas</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notification-text">Mensagem de notificação</span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAwgRDqqyuICq9L4R00J6ZfOtgjrDK4JH4",
            authDomain: "cadastroage.firebaseapp.com",
            projectId: "cadastroage",
            storageBucket: "cadastroage.firebasestorage.app",
            messagingSenderId: "561318294785",
            appId: "1:561318294785:web:3d9799b357bd5f661e5700",
            measurementId: "G-2WLC0MECDQ"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Referências do Firestore
        const usersRef = db.collection("users");
        const ordersRef = db.collection("orders");
        const techniciansRef = db.collection("technicians");
        
        // Estado atual do usuário
        let currentUser = null;
        
        // Elementos DOM
        const body = document.getElementById('body');
        const loginContainer = document.getElementById('login-container');
        const techContainer = document.getElementById('tech-container');
        const supervisorContainer = document.getElementById('supervisor-container');
        const adminContainer = document.getElementById('admin-container');
        
        const techSelect = document.getElementById('tech-select');
        const techLoginBtn = document.getElementById('tech-login-btn');
        
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const emailError = document.getElementById('email-error');
        const passwordError = document.getElementById('password-error');
        
        const logoutBtn = document.getElementById('logout-btn');
        const superLogoutBtn = document.getElementById('super-logout-btn');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        
        const userName = document.getElementById('user-name');
        const userRole = document.getElementById('user-role');
        const userAvatar = document.getElementById('user-avatar');
        const userId = document.getElementById('user-id');
        
        const superName = document.getElementById('super-name');
        const superRole = document.getElementById('super-role');
        const superAvatar = document.getElementById('super-avatar');
        const superId = document.getElementById('super-id');
        
        const adminName = document.getElementById('admin-name');
        const adminRole = document.getElementById('admin-role');
        const adminAvatar = document.getElementById('admin-avatar');
        const adminId = document.getElementById('admin-id');
        
        const osForm = document.getElementById('os-form');
        const serviceTypes = document.querySelectorAll('.service-type');
        const servicoInput = document.getElementById('servico');
        const submitBtn = document.getElementById('submit-btn');
        
        const osCount = document.getElementById('os-count');
        const ativacaoCount = document.getElementById('ativacao-count');
        const visitaCount = document.getElementById('visita-count');
        const mudancaCount = document.getElementById('mudanca-count');
        
        const techCount = document.getElementById('tech-count');
        const teamOsCount = document.getElementById('team-os-count');
        const activeTechs = document.getElementById('active-techs');
        const osMes = document.getElementById('os-mes');
        const supervisorCount = document.getElementById('supervisor-count');
        const technicianCount = document.getElementById('technician-count');
        const totalOsCount = document.getElementById('total-os-count');
        const osToday = document.getElementById('os-today');
        const osMonth = document.getElementById('os-month');
        
        const techList = document.getElementById('tech-list');
        const superExportBtn = document.getElementById('super-export-btn');
        const adminExportBtn = document.getElementById('admin-export-btn');
        
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        
        // Função para mostrar notificação
        function showNotification(message, isError = false) {
            notificationText.textContent = message;
            notification.className = isError ? 'notification error' : 'notification';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Preencher dropdown de técnicos
        function populateTechDropdown() {
            techniciansRef.get().then(snapshot => {
                techSelect.innerHTML = '<option value="">Selecione seu nome</option>';
                snapshot.forEach(doc => {
                    const tech = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = tech.name;
                    techSelect.appendChild(option);
                });
            }).catch(error => {
                console.error("Erro ao carregar técnicos: ", error);
                techSelect.innerHTML = '<option value="">Erro ao carregar técnicos</option>';
                showNotification("Erro ao carregar lista de técnicos", true);
            });
        }
        
        // Função para fazer login
        function login(email, password) {
            // Resetar erros
            emailError.style.display = 'none';
            passwordError.style.display = 'none';
            
            if (!email || !password) {
                showNotification("Por favor, preencha todos os campos", true);
                return;
            }
            
            // Botão de loading
            loginBtn.classList.add('loading');
            loginBtn.disabled = true;
            
            // Autenticar com Firebase
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const userId = userCredential.user.uid;
                    return usersRef.doc(userId).get();
                })
                .then(doc => {
                    if (doc.exists) {
                        currentUser = doc.data();
                        currentUser.id = doc.id;
                        
                        // Atualizar UI com base no perfil
                        updateUIForUser();
                        
                        // Mostrar painel apropriado
                        loginContainer.style.display = "none";
                        
                        if (currentUser.role === "tech") {
                            techContainer.style.display = "block";
                            updateTechDashboard();
                            body.className = "";
                            document.title = "Age Telecom | Painel do Técnico";
                        } else if (currentUser.role === "supervisor") {
                            supervisorContainer.style.display = "block";
                            loadSupervisorData();
                            body.className = "supervisor-mode";
                            document.title = "Age Telecom | Painel do Supervisor";
                        } else if (currentUser.role === "admin") {
                            adminContainer.style.display = "block";
                            loadAdminData();
                            body.className = "admin-mode";
                            document.title = "Age Telecom | Painel Master";
                        }
                        
                        showNotification(`Bem-vindo, ${currentUser.name}!`);
                    } else {
                        showNotification("Perfil de usuário não encontrado", true);
                    }
                })
                .catch(error => {
                    console.error("Erro de login: ", error);
                    if (error.code === "auth/user-not-found") {
                        emailError.style.display = 'block';
                    } else if (error.code === "auth/wrong-password") {
                        passwordError.style.display = 'block';
                    }
                    showNotification(error.message, true);
                })
                .finally(() => {
                    loginBtn.classList.remove('loading');
                    loginBtn.disabled = false;
                });
        }
        
        // Login para técnicos (sem senha)
        function loginTech(techId) {
            if (!techId) {
                showNotification("Por favor, selecione seu nome", true);
                return;
            }
            
            // Botão de loading
            techLoginBtn.classList.add('loading');
            techLoginBtn.disabled = true;
            
            techniciansRef.doc(techId).get()
                .then(doc => {
                    if (doc.exists) {
                        currentUser = doc.data();
                        currentUser.id = doc.id;
                        
                        // Buscar o supervisor para obter o nome
                        return usersRef.doc(currentUser.supervisor).get();
                    }
                    throw new Error("Técnico não encontrado");
                })
                .then(supervisorDoc => {
                    if (supervisorDoc && supervisorDoc.exists) {
                        currentUser.supervisorName = supervisorDoc.data().name;
                    }
                    
                    // Atualizar UI
                    updateUIForUser();
                    
                    // Mostrar painel do técnico
                    loginContainer.style.display = "none";
                    techContainer.style.display = "block";
                    body.className = "";
                    document.title = "Age Telecom | Painel do Técnico";
                    
                    // Atualizar dashboard
                    updateTechDashboard();
                    
                    showNotification(`Bem-vindo, ${currentUser.name}!`);
                })
                .catch(error => {
                    console.error("Erro ao buscar técnico: ", error);
                    showNotification(error.message || "Erro ao carregar dados do técnico", true);
                })
                .finally(() => {
                    techLoginBtn.classList.remove('loading');
                    techLoginBtn.disabled = false;
                });
        }
        
        // Atualizar UI para o usuário atual
        function updateUIForUser() {
            if (!currentUser) return;
            
            // Técnico
            if (currentUser.role === "tech") {
                userName.textContent = currentUser.name;
                userRole.textContent = "Técnico";
                userAvatar.textContent = currentUser.name.charAt(0);
                userId.textContent = `ID: ${currentUser.id}`;
            }
            // Supervisor
            else if (currentUser.role === "supervisor") {
                superName.textContent = currentUser.name;
                superRole.textContent = "Supervisor";
                superAvatar.textContent = currentUser.name.charAt(0);
                superId.textContent = `ID: ${currentUser.id}`;
            }
            // Admin
            else if (currentUser.role === "admin") {
                adminName.textContent = currentUser.name;
                adminRole.textContent = "Master";
                adminAvatar.textContent = "A";
                adminId.textContent = `ID: ${currentUser.id}`;
            }
        }
        
        // Atualizar dashboard do técnico
        function updateTechDashboard() {
            ordersRef.where("tecnico", "==", currentUser.id).get()
                .then(snapshot => {
                    const techOS = snapshot.docs.map(doc => doc.data());
                    const ativacoes = techOS.filter(os => os.servico === "ATIVAÇÃO").length;
                    const visitas = techOS.filter(os => os.servico === "VISITA TÉCNICA").length;
                    const mudancas = techOS.filter(os => os.servico === "MUDANÇA DE ENDEREÇO").length;
                    
                    osCount.textContent = techOS.length;
                    ativacaoCount.textContent = ativacoes;
                    visitaCount.textContent = visitas;
                    mudancaCount.textContent = mudancas;
                })
                .catch(error => {
                    console.error("Erro ao carregar OS: ", error);
                    showNotification("Erro ao carregar dados", true);
                });
        }
        
        // Carregar dados para supervisor
        function loadSupervisorData() {
            // Carregar técnicos da equipe
            techniciansRef.where("supervisor", "==", currentUser.id).get()
                .then(snapshot => {
                    const teamTechs = snapshot.docs;
                    techCount.textContent = teamTechs.length;
                    
                    // Obter IDs dos técnicos
                    const teamTechIds = teamTechs.map(doc => doc.id);
                    
                    // Contar técnicos ativos
                    const activeCount = teamTechs.filter(doc => doc.data().active).length;
                    activeTechs.textContent = activeCount;
                    
                    // Atualizar lista de técnicos
                    techList.innerHTML = '';
                    teamTechs.forEach(doc => {
                        const tech = doc.data();
                        
                        // Buscar contagem de OS para cada técnico
                        ordersRef.where("tecnico", "==", doc.id).get()
                            .then(ordersSnapshot => {
                                const techCard = document.createElement('div');
                                techCard.className = 'tech-card';
                                techCard.innerHTML = `
                                    <div class="tech-avatar">${tech.name.charAt(0)}</div>
                                    <div class="tech-info">
                                        <h4>${tech.name}</h4>
                                        <p>ID: ${doc.id} | OS: ${ordersSnapshot.size}</p>
                                    </div>
                                `;
                                techList.appendChild(techCard);
                            });
                    });
                    
                    // Carregar OS da equipe
                    return ordersRef.where("tecnico", "in", teamTechIds).get();
                })
                .then(snapshot => {
                    const supervisorOS = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return {
                            id: doc.id,
                            ...data
                        };
                    });
                    
                    teamOsCount.textContent = supervisorOS.length;
                    
                    // OS este mês
                    const thisMonth = new Date().getMonth() + 1;
                    const monthOS = supervisorOS.filter(os => {
                        const osMonth = parseInt(os.data.split('/')[1]);
                        return osMonth === thisMonth;
                    });
                    osMes.textContent = monthOS.length;
                    
                    // Atualizar tabela de OS
                    const tableBody = document.getElementById('super-table-body');
                    const noData = document.getElementById('super-no-data');
                    
                    tableBody.innerHTML = '';
                    
                    if (supervisorOS.length === 0) {
                        noData.style.display = 'block';
                        return;
                    }
                    
                    noData.style.display = 'none';
                    
                    // Ordenar por data (mais recente primeiro)
                    supervisorOS.sort((a, b) => {
                        return new Date(b.data) - new Date(a.data);
                    });
                    
                    // Mostrar apenas as últimas 10 OS
                    const recentOS = supervisorOS.slice(0, 10);
                    
                    recentOS.forEach(os => {
                        const row = document.createElement('tr');
                        
                        // Determinar classe do badge
                        let badgeClass = 'badge-ativacao';
                        if (os.servico.includes('VISITA')) badgeClass = 'badge-visita';
                        if (os.servico.includes('MUDANÇA')) badgeClass = 'badge-mudanca';
                        if (os.servico.includes('MESH')) badgeClass = 'badge-mesh';
                        
                        row.innerHTML = `
                            <td>${os.data}</td>
                            <td>${os.cliente}</td>
                            <td>${os.contrato}</td>
                            <td><span class="service-badge ${badgeClass}">${os.servico}</span></td>
                            <td>${os.tecnicoName || 'Técnico não encontrado'}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error("Erro ao carregar dados do supervisor: ", error);
                    showNotification("Erro ao carregar dados da equipe", true);
                });
        }
        
        // Carregar dados para admin
        function loadAdminData() {
            // Carregar estatísticas
            Promise.all([
                usersRef.where("role", "==", "supervisor").get(),
                techniciansRef.get(),
                ordersRef.orderBy("createdAt", "desc").limit(100).get()
            ])
            .then(([supervisorsSnapshot, techsSnapshot, ordersSnapshot]) => {
                // Atualizar contadores
                supervisorCount.textContent = supervisorsSnapshot.size;
                technicianCount.textContent = techsSnapshot.size;
                totalOsCount.textContent = ordersSnapshot.size;
                
                // Contar OS de hoje
                const today = new Date();
                const todayString = today.toLocaleDateString('pt-BR');
                const todayOS = ordersSnapshot.docs.filter(doc => {
                    const osDate = doc.data().data.split(' ')[0];
                    return osDate === todayString;
                });
                osToday.textContent = todayOS.length;
                
                // Contar OS deste mês
                const thisMonth = today.getMonth() + 1;
                const monthOS = ordersSnapshot.docs.filter(doc => {
                    const osDate = new Date(doc.data().createdAt?.toDate() || doc.data().data);
                    return osDate.getMonth() + 1 === thisMonth;
                });
                osMonth.textContent = monthOS.length;
                
                // Atualizar tabela de OS
                const tableBody = document.getElementById('admin-table-body');
                const noData = document.getElementById('admin-no-data');
                
                tableBody.innerHTML = '';
                
                if (ordersSnapshot.size === 0) {
                    noData.style.display = 'block';
                    return;
                }
                
                noData.style.display = 'none';
                
                // Mostrar apenas as últimas 20 OS
                const recentOS = ordersSnapshot.docs.slice(0, 20);
                
                recentOS.forEach(doc => {
                    const os = doc.data();
                    const row = document.createElement('tr');
                    
                    // Determinar classe do badge
                    let badgeClass = 'badge-ativacao';
                    if (os.servico.includes('VISITA')) badgeClass = 'badge-visita';
                    if (os.servico.includes('MUDANÇA')) badgeClass = 'badge-mudanca';
                    if (os.servico.includes('MESH')) badgeClass = 'badge-mesh';
                    
                    // Formatar data para exibição
                    const displayDate = os.data || 
                        (os.createdAt ? new Date(os.createdAt.toDate()).toLocaleString('pt-BR') : '');
                    
                    row.innerHTML = `
                        <td>${displayDate}</td>
                        <td>${os.cliente}</td>
                        <td>${os.contrato}</td>
                        <td><span class="service-badge ${badgeClass}">${os.servico}</span></td>
                        <td>${os.tecnicoName || 'Técnico não encontrado'}</td>
                        <td>${os.supervisorName || 'Supervisor não encontrado'}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error("Erro ao carregar dados de admin: ", error);
                showNotification("Erro ao carregar dados administrativos", true);
            });
        }
        
        // Evento para seleção do tipo de serviço
        serviceTypes.forEach(type => {
            type.addEventListener('click', function() {
                // Remover seleção anterior
                serviceTypes.forEach(t => t.classList.remove('selected'));
                
                // Adicionar seleção ao item clicado
                this.classList.add('selected');
                
                // Atualizar o campo oculto com o valor
                servicoInput.value = this.getAttribute('data-value');
            });
        });
        
        // Evento de envio do formulário de OS
        osForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!servicoInput.value) {
                showNotification('Por favor, selecione o tipo de serviço', true);
                return;
            }
            
            // Botão de loading
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            // Criar objeto OS
            const today = new Date();
            const osData = {
                cliente: document.getElementById('cliente').value,
                contrato: document.getElementById('contrato').value,
                servico: servicoInput.value,
                tecnico: currentUser.id,
                tecnicoName: currentUser.name,
                supervisor: currentUser.supervisor,
                supervisorName: currentUser.supervisorName,
                data: today.toLocaleDateString('pt-BR') + ' ' + today.toLocaleTimeString('pt-BR').slice(0, 5),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Adicionar ao Firestore
            ordersRef.add(osData)
                .then(() => {
                    showNotification('OS cadastrada com sucesso!');
                    osForm.reset();
                    serviceTypes.forEach(t => t.classList.remove('selected'));
                    servicoInput.value = '';
                    
                    // Atualizar dashboard
                    if (currentUser.role === "tech") {
                        updateTechDashboard();
                    }
                })
                .catch(error => {
                    console.error("Erro ao salvar OS: ", error);
                    showNotification(`Erro ao cadastrar OS: ${error.message}`, true);
                })
                .finally(() => {
                    submitBtn.classList.remove('loading');
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                });
        });
        
        // Evento de login para técnicos
        techLoginBtn.addEventListener('click', () => {
            loginTech(techSelect.value);
        });
        
        // Evento de login para administração
        loginBtn.addEventListener('click', () => {
            login(loginEmail.value, loginPassword.value);
        });
        
        // Permitir login com Enter
        loginPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login(loginEmail.value, loginPassword.value);
            }
        });
        
        // Eventos de logout
        logoutBtn.addEventListener('click', logout);
        superLogoutBtn.addEventListener('click', logout);
        adminLogoutBtn.addEventListener('click', logout);
        
        function logout() {
            // Fazer logout do Firebase se estiver autenticado
            if (auth.currentUser) {
                auth.signOut();
            }
            
            currentUser = null;
            techContainer.style.display = "none";
            supervisorContainer.style.display = "none";
            adminContainer.style.display = "none";
            loginContainer.style.display = "block";
            loginEmail.value = "";
            loginPassword.value = "";
            techSelect.value = "";
            body.className = "";
            document.title = "Sistema de Gestão de OS - Age Telecom";
            
            // Resetar erros
            emailError.style.display = 'none';
            passwordError.style.display = 'none';
        }
        
        // Eventos de exportação
        superExportBtn.addEventListener('click', () => {
            showNotification("Relatório da equipe exportado com sucesso!");
        });
        
        adminExportBtn.addEventListener('click', () => {
            showNotification("Relatório completo exportado com sucesso!");
        });
        
        // Troca de abas
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remover classe ativa de todas as abas
                tabs.forEach(t => t.classList.remove('active'));
                
                // Adicionar classe ativa à aba clicada
                this.classList.add('active');
                
                // Mostrar o conteúdo correspondente
                const tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Inicializar dados
        window.onload = function() {
            populateTechDropdown();
            showNotification("Sistema de Gestão de OS iniciado. Selecione seu nome para continuar.");
        };
    </script>
</body>
</html>